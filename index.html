<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Budget">
  <title>Monthly Budget</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    const Plus = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );
    
    const X = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );
    
    const Archive = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="21 8 21 21 3 21 3 8"></polyline>
        <rect x="1" y="3" width="22" height="5"></rect>
        <line x1="10" y1="12" x2="14" y2="12"></line>
      </svg>
    );
    
    const ChevronLeft = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    );

    const ChevronDown = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    );

    const ChevronUp = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <polyline points="18 15 12 9 6 15"></polyline>
      </svg>
    );

    const Download = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
    );

    const Upload = ({size = 24}) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="17 8 12 3 7 8"></polyline>
        <line x1="12" y1="3" x2="12" y2="15"></line>
      </svg>
    );

    function BudgetApp() {
      const [view, setView] = useState('current');
      const [incomes, setIncomes] = useState([]);
      const [expenses, setExpenses] = useState([]);
      const [transactions, setTransactions] = useState([]);
      const [archivedMonths, setArchivedMonths] = useState([]);
      const [showIncomeModal, setShowIncomeModal] = useState(false);
      const [showExpenseModal, setShowExpenseModal] = useState(false);
      const [showTransactionModal, setShowTransactionModal] = useState(false);
      const [showImportModal, setShowImportModal] = useState(false);
      const [incomesExpanded, setIncomesExpanded] = useState(true);
      const [expensesExpanded, setExpensesExpanded] = useState(true);
      const [expandedWeeks, setExpandedWeeks] = useState({});
      const [newIncome, setNewIncome] = useState({ description: '', amount: '' });
      const [newExpense, setNewExpense] = useState({ name: '', amount: '' });
      const [newTransaction, setNewTransaction] = useState({ description: '', amount: '', type: 'groceries' });

      useEffect(() => {
        loadData();
        checkAndArchiveIfNeeded();
      }, []);

      const formatDate = (date) => {
        const d = new Date(date);
        const day = String(d.getDate()).padStart(2, '0');
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const year = d.getFullYear();
        return day + '-' + month + '-' + year;
      };

      const getCurrentPeriod = () => {
        const now = new Date();
        const day = now.getDate();
        const month = now.getMonth();
        const year = now.getFullYear();
        
        if (day >= 27) {
          const nextMonth = month === 11 ? 0 : month + 1;
          const nextYear = month === 11 ? year + 1 : year;
          const startDate = new Date(year, month, 27);
          const endDate = new Date(nextYear, nextMonth, 26);
          return formatDate(startDate) + ' to ' + formatDate(endDate);
        } else {
          const prevMonth = month === 0 ? 11 : month - 1;
          const prevYear = month === 0 ? year - 1 : year;
          const startDate = new Date(prevYear, prevMonth, 27);
          const endDate = new Date(year, month, 26);
          return formatDate(startDate) + ' to ' + formatDate(endDate);
        }
      };

      const getMondayOfWeek = (date) => {
        const d = new Date(date);
        const day = d.getDay();
        const diff = d.getDate() - day + (day === 0 ? -6 : 1);
        return new Date(d.setDate(diff));
      };

      const getWeekLabel = (monday) => {
        const sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        const formatShort = (d) => {
          const day = String(d.getDate()).padStart(2, '0');
          const month = d.toLocaleDateString('en-GB', {month: 'short'});
          return day + ' ' + month;
        };
        return formatShort(monday) + ' - ' + formatShort(sunday);
      };

      const isWeekComplete = (monday) => {
        const sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        return new Date() > sunday;
      };

      const groupTransactionsByWeek = () => {
        const weeks = {};
        
        transactions.forEach(transaction => {
          const parts = transaction.date.split('-');
          const transDate = new Date(parts[2], parts[1] - 1, parts[0]);
          const monday = getMondayOfWeek(transDate);
          const weekKey = monday.toISOString().split('T')[0];
          
          if (!weeks[weekKey]) {
            weeks[weekKey] = {
              monday: monday,
              label: getWeekLabel(monday),
              transactions: [],
              isComplete: isWeekComplete(monday)
            };
          }
          
          weeks[weekKey].transactions.push(transaction);
        });

        return Object.entries(weeks).sort((a, b) => new Date(b[0]) - new Date(a[0]));
      };

      const loadData = () => {
        const currentPeriod = getCurrentPeriod();
        const savedIncomes = localStorage.getItem('budget:incomes');
        const savedExpenses = localStorage.getItem('budget:expenses');
        const savedTransactions = localStorage.getItem('budget:transactions:' + currentPeriod);
        const savedArchived = localStorage.getItem('budget:archived');
        
        if (savedIncomes) setIncomes(JSON.parse(savedIncomes));
        if (savedExpenses) setExpenses(JSON.parse(savedExpenses));
        if (savedTransactions) setTransactions(JSON.parse(savedTransactions));
        if (savedArchived) setArchivedMonths(JSON.parse(savedArchived));
      };

      const checkAndArchiveIfNeeded = () => {
        const lastCheck = localStorage.getItem('budget:last_check');
        const currentPeriod = getCurrentPeriod();
        
        if (lastCheck && lastCheck !== currentPeriod) {
          archiveCurrentMonth(lastCheck);
        }
        
        localStorage.setItem('budget:last_check', currentPeriod);
      };

      const archiveCurrentMonth = (period) => {
        const savedTransactions = localStorage.getItem('budget:transactions:' + period);
        const savedExpenses = localStorage.getItem('budget:expenses');
        const savedIncomes = localStorage.getItem('budget:incomes');
        
        if (savedTransactions || savedExpenses || savedIncomes) {
          const archived = {
            period: period,
            incomes: savedIncomes ? JSON.parse(savedIncomes) : [],
            expenses: savedExpenses ? JSON.parse(savedExpenses) : [],
            transactions: savedTransactions ? JSON.parse(savedTransactions) : [],
            archivedDate: new Date().toISOString()
          };
          
          const existing = localStorage.getItem('budget:archived');
          const existingArchive = existing ? JSON.parse(existing) : [];
          const updated = [archived].concat(existingArchive);
          
          localStorage.setItem('budget:archived', JSON.stringify(updated));
          setArchivedMonths(updated);
          localStorage.removeItem('budget:transactions:' + period);
        }
      };

      const addIncome = () => {
        if (newIncome.description && newIncome.amount) {
          const updated = incomes.concat([{ id: Date.now(), description: newIncome.description, amount: newIncome.amount }]);
          setIncomes(updated);
          localStorage.setItem('budget:incomes', JSON.stringify(updated));
          setNewIncome({ description: '', amount: '' });
          setShowIncomeModal(false);
        }
      };

      const removeIncome = (id) => {
        const updated = incomes.filter(i => i.id !== id);
        setIncomes(updated);
        localStorage.setItem('budget:incomes', JSON.stringify(updated));
      };

      const addExpense = () => {
        if (newExpense.name && newExpense.amount) {
          const updated = expenses.concat([{ id: Date.now(), name: newExpense.name, amount: newExpense.amount }]);
          setExpenses(updated);
          localStorage.setItem('budget:expenses', JSON.stringify(updated));
          setNewExpense({ name: '', amount: '' });
          setShowExpenseModal(false);
        }
      };

      const removeExpense = (id) => {
        const updated = expenses.filter(e => e.id !== id);
        setExpenses(updated);
        localStorage.setItem('budget:expenses', JSON.stringify(updated));
      };

      const addTransaction = () => {
        const needsDescription = newTransaction.type === 'fun';
        const isValid = newTransaction.amount && (!needsDescription || newTransaction.description);
        
        if (isValid) {
          const currentPeriod = getCurrentPeriod();
          const description = newTransaction.description || 'Groceries';
          const updated = [{
            id: Date.now(),
            date: formatDate(new Date()),
            description: description,
            amount: newTransaction.amount,
            type: newTransaction.type
          }].concat(transactions);
          setTransactions(updated);
          localStorage.setItem('budget:transactions:' + currentPeriod, JSON.stringify(updated));
          setNewTransaction({ description: '', amount: '', type: 'groceries' });
          setShowTransactionModal(false);
        }
      };

      const removeTransaction = (id) => {
        const currentPeriod = getCurrentPeriod();
        const updated = transactions.filter(t => t.id !== id);
        setTransactions(updated);
        localStorage.setItem('budget:transactions:' + currentPeriod, JSON.stringify(updated));
      };

      const exportData = () => {
        try {
          const currentPeriod = getCurrentPeriod();
          const data = {
            incomes: incomes,
            expenses: expenses,
            transactions: transactions,
            archivedMonths: archivedMonths,
            currentPeriod: currentPeriod,
            exportDate: new Date().toISOString()
          };
          
          const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'budget-backup-' + formatDate(new Date()) + '.json';
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        } catch (error) {
          alert('Error exporting data: ' + error.message);
        }
      };

      const importData = (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            const data = JSON.parse(e.target.result);
            
            if (!data.currentPeriod) {
              alert('Invalid backup file');
              return;
            }

            if (data.incomes) {
              setIncomes(data.incomes);
              localStorage.setItem('budget:incomes', JSON.stringify(data.incomes));
            }
            
            if (data.expenses) {
              setExpenses(data.expenses);
              localStorage.setItem('budget:expenses', JSON.stringify(data.expenses));
            }
            
            if (data.transactions) {
              setTransactions(data.transactions);
              localStorage.setItem('budget:transactions:' + getCurrentPeriod(), JSON.stringify(data.transactions));
            }
            
            if (data.archivedMonths) {
              setArchivedMonths(data.archivedMonths);
              localStorage.setItem('budget:archived', JSON.stringify(data.archivedMonths));
            }

            setShowImportModal(false);
            alert('Data imported successfully!');
          } catch (error) {
            alert('Error importing data: ' + error.message);
          }
        };
        reader.readAsText(file);
      };

      const totalIncome = incomes.reduce((sum, i) => sum + parseFloat(i.amount || 0), 0);
      const totalExpenses = expenses.reduce((sum, e) => sum + parseFloat(e.amount || 0), 0);
      const totalSpent = transactions.reduce((sum, t) => sum + parseFloat(t.amount || 0), 0);
      const remaining = totalIncome - totalExpenses - totalSpent;

      if (view === 'archive') {
        const yearTotal = archivedMonths.reduce((sum, month) => {
          const monthIncome = month.incomes ? month.incomes.reduce((s, i) => s + parseFloat(i.amount || 0), 0) : 0;
          const monthExpenses = month.expenses.reduce((s, e) => s + parseFloat(e.amount || 0), 0);
          const monthSpent = month.transactions.reduce((s, t) => s + parseFloat(t.amount || 0), 0);
          const monthResult = monthIncome - monthExpenses - monthSpent;
          return sum + monthResult;
        }, 0);

        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 pb-20">
            <div className="max-w-md mx-auto">
              <div className="bg-white rounded-2xl shadow-lg p-6 mb-4">
                <button onClick={() => setView('current')} className="flex items-center gap-2 text-indigo-600 hover:text-indigo-700 mb-4">
                  <ChevronLeft size={20} />
                  Back to Current Month
                </button>
                <h1 className="text-2xl font-bold text-gray-800 flex items-center gap-2 mb-4">
                  <Archive />
                  Archive
                </h1>
                
                {archivedMonths.length > 0 && (
                  <div className={yearTotal >= 0 ? 'bg-green-100 rounded-xl p-4' : 'bg-red-100 rounded-xl p-4'}>
                    <div className="text-sm font-medium text-gray-700 mb-1">Total Year Savings</div>
                    <div className={yearTotal >= 0 ? 'text-3xl font-bold text-green-800' : 'text-3xl font-bold text-red-800'}>
                      {yearTotal >= 0 ? '+' : ''}€{yearTotal.toFixed(2)}
                    </div>
                  </div>
                )}
              </div>

              {archivedMonths.length === 0 ? (
                <div className="bg-white rounded-2xl shadow-lg p-6">
                  <p className="text-gray-500 text-center">No archived months yet</p>
                </div>
              ) : (
                <div className="space-y-4">
                  {archivedMonths.map((month, index) => {
                    const monthIncome = month.incomes ? month.incomes.reduce((s, i) => s + parseFloat(i.amount || 0), 0) : 0;
                    const monthExpenses = month.expenses.reduce((sum, e) => sum + parseFloat(e.amount || 0), 0);
                    const monthSpent = month.transactions.reduce((sum, t) => sum + parseFloat(t.amount || 0), 0);
                    const monthResult = monthIncome - monthExpenses - monthSpent;
                    
                    return (
                      <div key={index} className="bg-white rounded-2xl shadow-lg p-6">
                        <div className="flex justify-between items-start mb-3">
                          <h3 className="font-bold text-gray-800">{month.period}</h3>
                          <div className={monthResult >= 0 ? 'px-3 py-1 rounded-full bg-green-100' : 'px-3 py-1 rounded-full bg-red-100'}>
                             className="text-gray-800 font-medium">{expense.name}</span>
                      <div className="flex items-center gap-2">
                        <span className="text-gray-800 font-bold">€{expense.amount}</span>
                        <button onClick={() => removeExpense(expense.id)} className="text-red-500 hover:text-red-700">
                          <X size={18} />
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              ))}
            </div>

            <div className="bg-white rounded-2xl shadow-lg p-6">
              <div className="flex justify-between items-center cursor-pointer" onClick={() => setIncomesExpanded(!incomesExpanded)}>
                <div className="flex items-center gap-2">
                  <h2 className="text-lg font-bold text-gray-800">Monthly Income</h2>
                  {incomes.length > 0 && (<span className="text-sm text-gray-600">(€{totalIncome.toFixed(2)})</span>)}
                </div>
                <div className="flex items-center gap-2">
                  <button onClick={(e) => { e.stopPropagation(); setShowIncomeModal(true); }} className="bg-green-600 text-white px-3 py-1 rounded-lg text-sm flex items-center gap-1 hover:bg-green-700">
                    <Plus size={16} /> Add
                  </button>
                  {incomes.length > 0 && (incomesExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />)}
                </div>
              </div>
              
              {incomesExpanded && (incomes.length === 0 ? (
                <p className="text-gray-500 text-sm text-center py-4">No income entries yet</p>
              ) : (
                <div className="space-y-2 mt-4">
                  {incomes.map(income => (
                    <div key={income.id} className="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                      <span className="text-gray-800 font-medium">{income.description}</span>
                      <div className="flex items-center gap-2">
                        <span className="text-gray-800 font-bold">€{income.amount}</span>
                        <button onClick={() => removeIncome(income.id)} className="text-red-500 hover:text-red-700">
                          <X size={18} />
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              ))}
            </div>
          </div>

          {showIncomeModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-2xl p-6 w-full max-w-sm">
                <h3 className="text-xl font-bold mb-4">Add Income</h3>
                <input type="text" placeholder="Description (e.g., Salary)" value={newIncome.description} onChange={(e) => setNewIncome({description: e.target.value, amount: newIncome.amount})} className="w-full px-4 py-2 border border-gray-300 rounded-lg mb-3 focus:ring-2 focus:ring-green-500" />
                <input type="number" placeholder="Amount" value={newIncome.amount} onChange={(e) => setNewIncome({description: newIncome.description, amount: e.target.value})} className="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-green-500" />
                <div className="flex gap-2">
                  <button onClick={() => setShowIncomeModal(false)} className="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Cancel</button>
                  <button onClick={addIncome} className="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Add</button>
                </div>
              </div>
            </div>
          )}

          {showExpenseModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-2xl p-6 w-full max-w-sm">
                <h3 className="text-xl font-bold mb-4">Add Fixed Expense</h3>
                <input type="text" placeholder="Expense name (e.g., Rent)" value={newExpense.name} onChange={(e) => setNewExpense({name: e.target.value, amount: newExpense.amount})} className="w-full px-4 py-2 border border-gray-300 rounded-lg mb-3 focus:ring-2 focus:ring-indigo-500" />
                <input type="number" placeholder="Amount" value={newExpense.amount} onChange={(e) => setNewExpense({name: newExpense.name, amount: e.target.value})} className="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-indigo-500" />
                <div className="flex gap-2">
                  <button onClick={() => setShowExpenseModal(false)} className="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Cancel</button>
                  <button onClick={addExpense} className="flex-1 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">Add</button>
                </div>
              </div>
            </div>
          )}

          {showTransactionModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-2xl p-6 w-full max-w-sm">
                <h3 className="text-xl font-bold mb-4">Log Spending</h3>
                <select value={newTransaction.type} onChange={(e) => setNewTransaction({description: newTransaction.description, amount: newTransaction.amount, type: e.target.value})} className="w-full px-4 py-2 border border-gray-300 rounded-lg mb-3 focus:ring-2 focus:ring-green-500">
                  <option value="groceries">Groceries</option>
                  <option value="fun">Fun/Incidental</option>
                </select>
                <input type="text" placeholder={newTransaction.type === 'groceries' ? 'Description (optional)' : 'Description (required)'} value={newTransaction.description} onChange={(e) => setNewTransaction({description: e.target.value, amount: newTransaction.amount, type: newTransaction.type})} className="w-full px-4 py-2 border border-gray-300 rounded-lg mb-3 focus:ring-2 focus:ring-green-500" />
                <input type="number" placeholder="Amount" value={newTransaction.amount} onChange={(e) => setNewTransaction({description: newTransaction.description, amount: e.target.value, type: newTransaction.type})} className="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4 focus:ring-2 focus:ring-green-500" />
                <div className="flex gap-2">
                  <button onClick={() => setShowTransactionModal(false)} className="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Cancel</button>
                  <button onClick={addTransaction} className="flex-1 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Log</button>
                </div>
              </div>
            </div>
          )}

          {showImportModal && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
              <div className="bg-white rounded-2xl p-6 w-full max-w-sm">
                <h3 className="text-xl font-bold mb-4">Import Data</h3>
                <p className="text-sm text-gray-600 mb-4">Select a backup file to restore your budget data. This will replace all current data.</p>
                <input type="file" accept=".json" onChange={importData} className="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4" />
                <button onClick={() => setShowImportModal(false)} className="w-full px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">Cancel</button>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.render(<BudgetApp />, document.getElementById('root'));
  </script>
</body>
</html> className={monthResult >= 0 ? 'text-sm font-bold text-green-800' : 'text-sm font-bold text-red-800'}>
                              {monthResult >= 0 ? '+' : ''}€{monthResult.toFixed(2)}
                            </span>
                          </div>
                        </div>
                        <div className="grid grid-cols-2 gap-3 text-center mb-4">
                          <div className="bg-green-50 rounded-lg p-3">
                            <div className="text-xs text-green-700 font-medium">Income</div>
                            <div className="text-lg font-bold text-green-800">€{monthIncome.toFixed(2)}</div>
                          </div>
                          <div className="bg-red-50 rounded-lg p-3">
                            <div className="text-xs text-red-700 font-medium">Spent</div>
                            <div className="text-lg font-bold text-red-800">€{(monthExpenses + monthSpent).toFixed(2)}</div>
                          </div>
                        </div>
                        
                        {month.incomes && month.incomes.length > 0 && (
                          <div className="mb-3">
                            <h4 className="text-sm font-semibold text-gray-700 mb-2">Income</h4>
                            <div className="space-y-1">
                              {month.incomes.map((inc, i) => (
                                <div key={i} className="flex justify-between text-sm bg-gray-50 p-2 rounded">
                                  <span>{inc.description}</span>
                                  <span className="font-medium">€{inc.amount}</span>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                        
                        {month.expenses.length > 0 && (
                          <div className="mb-3">
                            <h4 className="text-sm font-semibold text-gray-700 mb-2">Fixed Expenses</h4>
                            <div className="space-y-1">
                              {month.expenses.map((exp, i) => (
                                <div key={i} className="flex justify-between text-sm bg-gray-50 p-2 rounded">
                                  <span>{exp.name}</span>
                                  <span className="font-medium">€{exp.amount}</span>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                        
                        {month.transactions.length > 0 && (
                          <div>
                            <h4 className="text-sm font-semibold text-gray-700 mb-2">Transactions ({month.transactions.length})</h4>
                            <div className="space-y-1 max-h-40 overflow-y-auto">
                              {month.transactions.map((trans, i) => (
                                <div key={i} className="flex justify-between text-sm bg-gray-50 p-2 rounded">
                                  <span>{trans.description} ({trans.date})</span>
                                  <span className="font-medium">€{trans.amount}</span>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          </div>
        );
      }

      const weeklyTransactions = groupTransactionsByWeek();

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 pb-20">
          <div className="max-w-md mx-auto">
            <div className="bg-white rounded-2xl shadow-lg p-6 mb-4">
              <div className="flex justify-between items-center mb-4">
                <div>
                  <h1 className="text-2xl font-bold text-gray-800">Monthly Budget</h1>
                  <div className="text-sm text-gray-600 mt-1">{getCurrentPeriod()}</div>
                </div>
                <div className="flex items-center gap-2">
                  <button onClick={() => setShowImportModal(true)} className="flex items-center gap-1 text-sm text-gray-600 hover:text-gray-800 p-2" title="Import Data">
                    <Upload size={18} />
                  </button>
                  <button onClick={exportData} className="flex items-center gap-1 text-sm text-gray-600 hover:text-gray-800 p-2" title="Export Data">
                    <Download size={18} />
                  </button>
                  <button onClick={() => setView('archive')} className="flex items-center gap-1 text-sm text-indigo-600 hover:text-indigo-700">
                    <Archive size={18} />
                    <span className="hidden sm:inline">Archive</span>
                  </button>
                </div>
              </div>

              <div className="grid grid-cols-3 gap-3 text-center">
                <div className="bg-green-50 rounded-lg p-3">
                  <div className="text-xs text-green-700 font-medium">Income</div>
                  <div className="text-lg font-bold text-green-800">€{totalIncome.toFixed(2)}</div>
                </div>
                <div className="bg-red-50 rounded-lg p-3">
                  <div className="text-xs text-red-700 font-medium">Expenses</div>
                  <div className="text-lg font-bold text-red-800">€{(totalExpenses + totalSpent).toFixed(2)}</div>
                </div>
                <div className={remaining >= 0 ? 'bg-blue-50 rounded-lg p-3' : 'bg-orange-50 rounded-lg p-3'}>
                  <div className={remaining >= 0 ? 'text-xs font-medium text-blue-700' : 'text-xs font-medium text-orange-700'}>Remaining</div>
                  <div className={remaining >= 0 ? 'text-lg font-bold text-blue-800' : 'text-lg font-bold text-orange-800'}>€{remaining.toFixed(2)}</div>
                </div>
              </div>
            </div>

            <div className="bg-white rounded-2xl shadow-lg p-6 mb-4">
              <div className="flex justify-between items-center mb-4">
                <h2 className="text-lg font-bold text-gray-800">Daily Spending</h2>
                <button onClick={() => setShowTransactionModal(true)} className="bg-green-600 text-white px-3 py-1 rounded-lg text-sm flex items-center gap-1 hover:bg-green-700">
                  <Plus size={16} /> Log
                </button>
              </div>
              
              {transactions.length === 0 ? (
                <p className="text-gray-500 text-sm text-center py-4">No transactions yet</p>
              ) : (
                <div className="space-y-3">
                  {weeklyTransactions.map(([weekKey, week]) => {
                    const weekTotal = week.transactions.reduce((sum, t) => sum + parseFloat(t.amount || 0), 0);
                    const isExpanded = expandedWeeks[weekKey] !== false;
                    
                    return (
                      <div key={weekKey} className="border border-gray-200 rounded-lg">
                        <div className="flex justify-between items-center p-3 cursor-pointer hover:bg-gray-50" onClick={() => setExpandedWeeks(Object.assign({}, expandedWeeks, {[weekKey]: !isExpanded}))}>
                          <div>
                            <div className="font-semibold text-gray-800">{week.label}</div>
                            <div className="text-sm text-gray-600">{week.transactions.length} transactions</div>
                          </div>
                          <div className="flex items-center gap-2">
                            <span className="font-bold text-gray-800">€{weekTotal.toFixed(2)}</span>
                            {isExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                          </div>
                        </div>
                        
                        {isExpanded && (
                          <div className="border-t border-gray-200 p-3 space-y-2">
                            {week.transactions.map(transaction => (
                              <div key={transaction.id} className="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                                <div>
                                  <div className="text-gray-800 font-medium">{transaction.description}</div>
                                  <div className="text-xs text-gray-500">{transaction.date} • {transaction.type}</div>
                                </div>
                                <div className="flex items-center gap-2">
                                  <span className="text-gray-800 font-bold">€{transaction.amount}</span>
                                  <button onClick={() => removeTransaction(transaction.id)} className="text-red-500 hover:text-red-700">
                                    <X size={18} />
                                  </button>
                                </div>
                              </div>
                            ))}
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>
              )}
            </div>

            <div className="bg-white rounded-2xl shadow-lg p-6 mb-4">
              <div className="flex justify-between items-center cursor-pointer" onClick={() => setExpensesExpanded(!expensesExpanded)}>
                <div className="flex items-center gap-2">
                  <h2 className="text-lg font-bold text-gray-800">Fixed Expenses</h2>
                  {expenses.length > 0 && (<span className="text-sm text-gray-600">(€{totalExpenses.toFixed(2)})</span>)}
                </div>
                <div className="flex items-center gap-2">
                  <button onClick={(e) => { e.stopPropagation(); setShowExpenseModal(true); }} className="bg-indigo-600 text-white px-3 py-1 rounded-lg text-sm flex items-center gap-1 hover:bg-indigo-700">
                    <Plus size={16} /> Add
                  </button>
                  {expenses.length > 0 && (expensesExpanded ? <ChevronUp size={20} /> : <ChevronDown size={20} />)}
                </div>
              </div>
              
              {expensesExpanded && (expenses.length === 0 ? (
                <p className="text-gray-500 text-sm text-center py-4">No fixed expenses yet</p>
              ) : (
                <div className="space-y-2 mt-4">
                  {expenses.map(expense => (
                    <div key={expense.id} className="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                      <span